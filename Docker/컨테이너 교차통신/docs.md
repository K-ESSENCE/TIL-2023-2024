# container & network Requset

## 컨테이너에서 로컬 호스트 머신으로의 통신

HTTP요청을
웹사이트나 웹 API로 보내는 것이 도커화된 앱에서 할 수있는 유일한 통신 방식은 아님

우리가 호스팅 머신이나 데이터베이스 같은것을 갖고있을때 도커화된 앱 내부에서 통신하고자 할 수도있음

컨테이너 외부의 뭔가와 통신

뭔가? => 호스트머신에서 실행되는 서비스 (데이터베이스)

## 컨테이너간의 통신

컨테이너에서 www으로 / 컨테이너에서 호스트 머신으로

이거 외에 하나가더있는데 컨테이너 내부에서 실행되는 애가 다른애와 연결되는경우

또다른 에는SQL 컨테이너고 우리앱이 있는 예시.

다중 컨테이너로 앱을 구축하는것은 매우 일반적임

다중컨테이너 사용시 각각 컨테이너가 한가지 주요작업만 수행하는것이 강력히 권장됨

기본적으로 컨테이너는 월드 와이드 웹에 요청을 보낼 수 있음

## 적용

코드 내에서 도커에게 주는 특별한 힌트

```
mongoose.connect('mongodb://localhost:27017/swfavorites', { useNewUrlParser: true }, (err) => {

=> localhost:=> host.docker.internal:

```

서버가있다면 mongodb:// 말고 http://도 가능

docker run mongo // docker hub에서 다운로드

--name 옵션으로 mongodb로 실행

docker container inspect mongodb => networkSetting 객체에서 컨테이너의 IP주소를 찾을수있음.

이주소를 'mongodb://172.17.0.2:27017/swfavorites' 아까처럼 변경 이번엔 다른 컨테이너랑 통신가능

분리와 격리는 도커의 핵심개념이자 도커를 사용하는 핵심적인 이유.

### 우아한 컨테이너간 통신

도커로 컨테이너 네트워크라는것을 만들 수 있음

컨테이너간에 통신을 허용

docker run --network 모든 컨테이너를 하나의 동일한 네트워크로 밀어넣을수있다.

모든 컨테이너가 서로 통신할 수 있는 네트워크가 생성됨.

볼륨과 달리 네트워크 옵션은 자동으로 네트워크를 생성하지않음.

docker network create ${name}

docker network ls => 자신의 네트워크외에 내장 네트워크도 볼 수있음.

이번엔 mongodb://172.17.0.2:27017/swfavorites => ip주소를 다른 컨테이너로 바꿀수있음

이경우 mongodb 두개가 같은 네트워크면 알아서 변환됨

컨테이너 네트워크를 만들거나 IP를 조회하지않으면 일반적으로는 컨테이너간 통신이 불가능함

그러고보니 mongodb 실행시킬때 포트를 노출을 안시켰음

-p 옵션은 로컬 호스트머신이나 컨테이너 네트워크 외부에서 뭔가 연결할 경우에만 필요하기때문

- 정리

즉 로컬 호스트 머신과 통신은 internal

네트워크끼리는 컨테이너이름을 ip주소로 사용할수있음.

혹은 ip주소를 inspect로 까봐서 사용하는게 가능

### 네트워크 드라이버

기본은 bridge드라이버 --driver 옵션을 추가해서 간단히 설정가능
