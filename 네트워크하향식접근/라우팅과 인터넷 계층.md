# 인터넷 계층의 역할

## IP 어드레스 정보를 보고 데이터를 전달한다.

인터넷 계층은 네트워크 인터페이스 계층과 협력하여 다른 컴퓨터에게 데이터를 전달하는 역할을 한다.

하드웨어에 의존해야 하는 부분을 네트워크 인터페이스 계층이 담당하고, 인터넷 계층은 IP 어드레스라고 하는 식별자 정보를 실마리로 데이터를 전달할 수 있는 체계를 제공하도록 역할이 구분되어있음

## 라우터와 라우팅

데이터를 목적지까지 전달하기 위해서는 라우터라고 하는 네트워크 장비가 필요함. 라우터는 네트워크와 네트워크를 연결하는 역할을 하는데, 하나의 라우터는 데이터를 목적지까지 전달하기 위해 다음 네트워크의 경로를 찾고, 경로상에 있는 라우터에게 데이터 전달을 위임.

이런 연쇄작업으로 목적지의 경로를 찾아 나가는 과정을 라우팅이라고함.

## IP 어드레스와 관련된 여러 기술

인터넷 보급이 급속도로 확산됨에 따라 IP어드레스의 고갈을 방지하기 위한 대안으로 프라이빗 어드레스 와 퍼블릭 어드레스를 구분하는 기법을 사용함.

근본적인 바업으로는 IPv6의 도입이 가속화됨

# IPv4와 IPv6

## IPv4 는 32비트 어드레스

32비트는 사람이 보기 어렵기 때문에 8비트씩 끊어서 10진수로 표현

인터넷 계층에서 사용되는 장비에만 IP 어드레스가 할당된다.

여러 네트워크 장비들 중 네트워크 허브와 같이 네트워크 인터페이스 계층에서 사용되는 장비들에는 IP 어드레스가 할당되지 않음

## IPv4 헤더

버전 / 헤더길이 / 서비스타입 (우선순위 결정)| 패킷 길이

식별자 | 분할 플래그 | 프래그먼트옵셋

생존기간 | 프로토콜(트랜스포트 계층의 어느 프로토콜에 전달할지를 판단하는 번호) | 헤더 쳌섬

송신지 IP 어드레스

수신지 IP 어드레스

옵션설정 | 패딩

## IP 패킷에도 유통기한이 있다.

실제로 존재하지않는 수신지나 통신 경로를 찾지 못한 패킷이 인터넷 네트워크를 떠돌아댕기면 네트워크가 혼잡해질 수 있음으로 이러한 문제를 방지하기 위해 TTL 이 지나면 소멸시키도록 규정

## 좁은 길을 지날 때는 작게 분할해서 지나간다.

한번에 전송할 수 있는 데이터 크기를 MTU 라고 하고 통신 경로의 상태에 따라 달라짐.

라우터에는 MTU 값에 따라 패킷을 분할해서 전송하는 기능이 구현되어 있음. 다만 라우터의 작업 부하가 높거나 분할된 패킷 중의 일부가 유실되면 복원이 어려워지는 단점이 있다.

그래서 라우터가 데이터를 송신하기 전에 통신 경로 전체의 MTU를 살펴본 후 처음부터 MTU 보다 작은 크기의 패킷을 만들도록 설정하기도 함

## 데이터를 분할하고 복원하는 방법

식별자 ⇒ 같은 데이터 값인지 식별하는 16비트 숫자감

분할 플래그 ⇒ 분할 허가 플래그와 이후 남은 분할 부분이 더 있는지 표시하기 위한 플래그

프래그먼트 옵셋 ⇒ 원래 데이터에서의 위치 값을 표현하는 13비트 숫자 값

요는 식별자난 IP어드레스 정보 등을 보고 데이터가 분할된 조각을 모아 복원하는 거

## IPv6

버젼 (여기서는 6)/ 트래픽 클래스(패킷의 우선순위)/ 플로우 레이블

페이로드의 길이/ 다음헤더 / 홉 리미트 (IPv4의 생존 기간과 같은 역할 )

송진지 IP 어드레스

수신지 IP 어드레스

확장 헤더

IPv6는 애당초 라우터에서 데이터를 분할하지 않는 방식으로 사양이 만들어져 있어서 분할 관련 필드는 옵션으로 되어 있음

## IPv6로 갈아타기

듀얼스택 (하나의 장비에 두 종류의 어드레스를 할당한 후, 둘다 사용가능하도록 만듦) / 터널링 IPv4 네트워크를 지나갈 떄 IPv6vozltdmf codnjqhsoa

---

# IP 어드레스의 활용

## 네트워크 부와 호스트 부

IP 어드에스는 네트워크 부 와 호스트 부로 구성된다. 여기서 말하는 호스트는 네트워크에 연결된 컴퓨터나 네트워크 장비를 의미한다.

## 어드레스 클래스

하나의 IP 어드레서 안에서 어디까지가 네트워크 부이고 어디까지가 호스트 부인지 미리 길이를 고정하여 결정해 둔 것이 있는데, 이것을 어드레스 클래스라고 부른다.

아 , a,b,c 클래스이거

0~127 191 224

## 어드레스 클래스의 제약

클래스 A의 어드레스는 한 개의 네트워크당 약 1677만 대의 호스트의 어드레스를 할당할 수 있지만 실제로는 그렇게 많은 호스트를 하나의 네트워크에 연결하는 경우는 없기떄문에 많은 수의 어드레스가 사용되지않고 낭비됨

어드레스 클래스를사용한 네트워크를 좀 더 세분화할 수 있는데 이때 사용하는 것이 서브넷 마스크

## 서브넷 마스크

어드래스 클래스는 네트워크 부의 길이가 미리정해져있다. 하지만 서브넷 마사크를 이용하면 이 길이를 비트 단위로 유연하게 늘려서 쓰는 것이 가능하다.

## IP 어드레스의 할당 방법

IP 어드레스는 네트워크상에서 호스트를 식별하기 위해서 사용됨 그래서전체 32비트중네트워크부를제외한호스트 부 부분만 자유롭게 할당하여 사용할 수 있다.

### 서브넷마스크로 네트워크 세분화하기

서브넷 마스크를 사용하면 네트워크를더 세분화하여 서브 네트워크 ,즉 서브넷을 만들수있다.

서브넷 마스크의 한계 ⇒ 미리 정해진 네트워크부의 길이를 더 늘릴 수는 있지만, 더 줄이지는 못한다. 그래서 이미 호스트 길이가 짧게 만들어진 클래스 C인 경우 남은 8비트 내에서 서브넷 부와 호스트 부로 나누게 되므로 실제로 할당할수 있는호스트 대수가 급격히줄어들게 된다

그 결과 클래스 C에서는 서브넷을 사용하는것이 별 도움이 안됨

그래서 A,B의 어드레스를세분화해야할 때 사용하는것이 일반적임.

## 가정이나 사무실에 자유롭게 사용하는 프라이빗IP 어드레스

프라이빗IP 어드레스는가정이나 사내에서자유롭게사용할수있는 어드레스다.

인터넷이나 다른 네트워크에 연결되지 않아서 주소가 충돌만 나지 않는다면 다른 네트워크에서 사용 중인 어드레스를사용한다 해도 큰 문제는 없다.

다만, 프라이빗 IP 어드레스는인터넷에 연결해도 외부에서 접근할 수없기 떄문에NAT와 같은 어드레스 변환 기술을 사용해서 퍼블릭 IP로 변환해 주는 기법이 필요함.

인터넷에서 접속되어야 하는 서버들은 퍼블릭IP 어드레스가 반드시필요함.

라우터는 프라이빗,퍼블릭 둘다 가지고 있다.

## 퍼블릭IP 어드레스의 관리

퍼블릭은 인터넷 안에서 중복되면 안 되기 때문에 ICANN 이나 KRNI 과 같은 단체가 관리하고 있다.

퍼블릭 IP가 필요하면 각 단체에 신청해서 받아야 함.

### 인터넷 레지스트리

퍼블릭 IP는 인터넷 레지스트리를 통해 인터넷 서비스 제공자들에게 할당되고 기업이나 가정은 인터넷서비스 제공자가확보한 IP 어드레스 들을 빌려서 쓴다.

### 예약된 IP 어드레스

IP 어드레스중에는이미 예약된 특수 목적의 어드레스가 있다.

127.0.0.1은 루프백 어드레스 혹은 로컬호스트라고 부르는데 호스트 자신을가리킨다.

그 외에도 부의 비트를모두 1로 설정한어드레스는 해당 네트워크의 모든호스트들을의미하는 브로드캐스트 어드레스 가된다.

모두 0으로 된 경우는 네트워크 전체를 의미하는 어드레스가된다.

# 라우팅이란

## 라우팅과 경로 탐색

최종 목적지까지 연결되는 경로를 찾을 수있어야 하고 그 과정을 라우팅이라고 하고 이때 찾은 최적의 경로를 사용해서 통신을 하게 된다.

## 라우팅 프로토콜

네트워크 상의 각 라우터는 서로누구와 연결되어 있는지에 대한 정보를교환한다. 이때 사용됨

대표적으로 BGP , OSPF , RIP 등이 있다.

## 자율 시스템

인터넷 서비스 제공자가 사용하는 규모가 큰 네트워크에서는 몇 개의 네트워크를 하나로 묶어 자율 시스템(as)라는 단위로 관리한다. 네트워크의 경로 하나하나를 이동하는 대신 as와 같이 큰 덩어리의 접속 경로 단위로 이동하면 멀리 있는 컴퓨터와도 더 빠른 속도로 통신할 수있다.

# 라우터와 라우팅 프로토콜

## 라우터의 역할

라우터의 역할은 네트워크 간의 패킷을 전달하는 것이다.

이때 연결하고 있는 각 네트워크에서 사용하는 IP 어드레스가 각각 하나씩 필요하며, 결과적으로 연결한 네트워크 개수만큼의 IP 어드레스를 여러 개 가지게 된다.

- 가정용 초고속 인터넷 라우터

가정에서 사용되는 초고속 인터넷 라우터도 주택 내의 네트워크에서 사용하는 IP 어드레스와 인터넷 서비스 제공자의 네트워크에서 사용되는 IP 어드레스 각각을 가지고 있다.

단, 라우팅 기능은 경량화되어 있는데, 외부로 전달되어야 하는 패킷은 별도의 복잡한 처리 없이 바로 인터넷 서비스 제공자 측의 라우터로 전달하도록 되어있다

## 라우팅 테이블

라우터는 내부에 저장하고 있는 라우팅 테이블이라는 정보를 활용하여 라우팅을 한다.

라우팅 테이블에는 목적지 호스트가 속한 네트워크 정보와 그 네트워크로 도달하기 위해 경유해야 하는 라우터의 정보가 들어있다.

## 정적 라우팅과 동적 라우팅

라우팅 테이블을 만드는 방법 2가지

네트워크 관리자가 직접 수작업으로 설정하는 게 정적

자동으로 테이블 설정하는게 동적

- 라우팅 테이블에 목적지 정보가 없을 경우

인터넷에는 수많은 네트워크가 연결되어 있기 떄문에 모든 네트워크의 통신 경로를 저장하는 것은 사실상 불가능하다. 그래서 한 라우터의 라우팅 테이블에 목적지 정보가 없다면 해당 라우터보다 더 많은 정보를 가지고 있는 기본 라우터 혹은 디폴트 라우터에 물어보게 된다.

디폴트 라우터의 정보는 각 라우터마다 정적으로 설저오디어 있다.

## 동적 라우팅 알고리즘

거리 벡터형과 링크 상태형 두가지 AS간의 통신에서 사용되는 경로 벡터형도있음

### 거리 벡터형

RIP프로토콜이 사용하는 방식 목적지 까지의 거리를 살표보고 짧은 경로 선택

경로는 라우터의 수를 의미하는 홉의 수로 센다.

### 링크 상태형

OSPF 프로토콜이 사용하는 방식으로 네트워크의 통신 상태 정보를 맵으로 관리하면서 상태가 가장 좋은 경로를 선택하는 방식 복잡하고 변화가 잦은 네트워크 구성에 적합함.

### AS내에서 사용되는 OSPF

AS 안에서는 주로 링크 상태형인 OSPF를 사용한다. 하지만 링크 상태형은 규모가 커지면 맵 정보를 처리하는 부하가 커질 수 있다. 따라서 네트워크를 몇 개의 영역으로 분할한 후 각 영역별로 맵을 따로 만드는 방식을 사용

### AS 간에 사용되는 BGP

경로 벡터형인 BGP가 as 끼리에서 사용됨 경로 벡터형은 경로의 거리랑 경유하는 AS정보도 포함하여 경로정보를 만듦

- AS번호
  - AS에는 IP어드레스처럼 16/32비트 길이의 AS번호가 할당됨. AS 번호는 퍼블릭 AS번호와 프라이빗AS번호로 나누어지고, 퍼블릭 AS 번호는 퍼블릭 IP 어드레스와 마찬가지로 전 세계적으로 중복되지 않도록 관리됨 AS 번호 역시 인터넷 레지스트리 신청하면 된다.

# 네트워크 오류를 통보하는 ICMP

## ICMP의 동작 방식

데이터 전송 중에 문제가 생길 경우 장애 상황을 통보하기 위해 사용된다.

ICMP 패킷은 IP헤더에 타입이나 코드와 같은 ICMP 메시지를 덧붙인 형태.

## 주요 ICMP메시지

패킷의 생존 기간 TTL 이 경과하게 되면 이 패킷은 네트워크상에서 소멸되는데, 이 때 라우터가 패킷을 송신 측으로 타입 11번 ICMP메시지를 보내게된다.

핲년 네트워크에 속한 라우터의 IP 어드레스를 알고 싶을 떄는 10,9 번 ICMP메시지를 사용하면된다.

라우터 요청 메시지 ⇒ 장비가 네트워크에 연결될 떄 라우터를 찾기 위해 보내는 메시지 RS

라우터 광고 메시지 ⇒ 라우터 정보 요청에 대한 응답으로 라우터 정보를 보내는 메시지 RA

# 어드레스 변환

## 네트워크 어드레스 변환(NAT)의 동작 방식

가정이나 사무실의 네트워크에서는 보통 프라이빗 IP 어드레스를 사용한다. 내부에서만 쓰기떄문에 변환이 필요한데 이때 네트워크 어드레스 변환 NAT 기술ㅇ이 사용됨 프라이빗 외에도 IPv4⇒6 간의 변환에도 사용된다.

라우터는 IP 어드레스를 변환했다는 것을 기억함.

## NAT에서 발생할 수 있는 제약 사항

NAT는 단순히 IP 어드레스를 변환할 뿐이다. 그래서 내부의 여러 호스트가 공교롭게 같은 포트 번호를 사용하고 있다면 라우터는 이 요청에 대한 응답을 어느 호스트에게 되돌려 보내야 하는지 포트만 보고는 판단하지 못한다.

내부에서 보낸 요청에 대한 응답은 받을 수 있지만 외부에서 일방적으로 보낸 데이터 NAT 범위 안에 있는 호스트로 전달 안됨

## 네트워크 어드레스 포트 변환

이런 제약 사항과 같이 NAT의 포트 번호 충돌을 막기 위해 만들어진게 NAPT IP 어드레스 뿐만 아니라 포트번호도 함께 변환된다.

프라이빗 IP를 여러 호스트가 같은 포트번호 쓰면 충돌안나도록 바꿔서 보냄

## 외부에서 접속이 가능하게 하려면

### 메시지의 자동확인

SNS 같은 건 메시지의 도착 여뷰를 정기적으로 확인 요청하는 방법으로 구현된다.

사용자가 직접 요청한 것은 아니지만 내부에서 외부로 자동으로 정보를 요청하고 응답받는 형식이라 ㄱㅊ

### 포트 포워딩

LAN 안에 웹 서버나 FTP 서버를 운영하면서 외부로 이 서비스를 공개해야 할 떄가 있다. 이때 라우터의 특정 포트 번호로 통신이 들어오면 내부의 특정 서버에 전달되도록 설정할 수 있는데 이 방법을 포트포워딩이라고한다.

# 도메인명

## 호스트명과 도메인명

서로 다른 컴퓨터를 구분하는 식별자로는 IP 어드레스와 호스트명이 있는데 이 정보를 관리하기 위해 DNS 와 도메인명이라는것이 있음.

주의할 것은 도메인의 표현 방식이 호스트명을 계층적인 형태로 표현하고 있으나, 실제로는 단순히 분류 체계의 성격으로 표현하고 있을 뿐 실제 네트워크 구성 형태가 계층적이라는 의미가 아님

### 도메인의 계층 구조

탑 레벨 도메인 com / 서브 레벨 도메인 co go ac

### DNS 서버의 계층 구조

도메인 명의 계층과 완전히 일치하지는 않지만 DNS 서버도 계층적으로 구성된다.

도메인명 데이터를 직접 관리하는 DNS 서버를 DNS 콘텐츠 서버라고 부른다.

## DNS 서버에 질의하는 처리 과정

DNS서버는 크게 콘텐츠 서버랑 캐시 서버

캐시 서버는 루트 네임 서버부터 순차적으로 질의

- hosts 파일

인터넷 초창기에는 호스트명 과 IP 어드레스를 매핑하기 위해 텍스트 파일 형태인 hosts파일을 사용해서 IP 어드레스 변환을 했었다.

오늘날의 OS에도 이 흔적은 남아 있어서 DNS에 등록되기 전의 서버나 DNS에 등록할 수 없는 서버에 접근해야 할 경우 hosts 파일 방식을 사용하기도한다.

## DNS에 도메인 등록하기

DNS 서버에 등록되는 정보를 리소스 레코드라고 부르고, 리소스 레코드가 등록된 파일을 존 파일이라고 함

### 리소스 레코드 의미

SOA 레코드 해당 도메인명을 관리하는 DNS 서버를 기술

NS 레코드 프라이머리,세컨더리 DNS 서버를 기술

A 레코드 호스트명과 IP 어드레스를 연결

CNAME 레도크 A레코드에서 지정된 호스트에 별명을 부여
MX 레코드 메일 어드레스와 메일 서버를 연결함
